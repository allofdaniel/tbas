# RKPU Viewer 백엔드 API 명세서

> 버전: 2.0.0 | 업데이트: 2025-01-11

---

## 1. 항공기 실시간 위치 API

### `/api/aircraft`

| 항목 | 값 |
|------|-----|
| **메서드** | GET |
| **소스** | `api.airplanes.live/v2/point/{lat}/{lon}/{radius}` |
| **파라미터** | `lat` (위도), `lon` (경도), `radius` (반경 NM, 기본값 100) |
| **캐시** | 2초 |

**응답 형식:**
```json
{
  "ac": [
    {
      "hex": "71C2A8",
      "flight": "KAL319",
      "r": "HL8319",
      "t": "B77W",
      "lat": 35.593,
      "lon": 129.351,
      "alt_baro": 35000,
      "alt_geom": 35200,
      "gs": 450,
      "track": 270,
      "squawk": "1234"
    }
  ]
}
```

---

## 2. 항공기 궤적 API

### `/api/aircraft-trace`

| 항목 | 값 |
|------|-----|
| **메서드** | GET |
| **소스** | `api.airplanes.live/v2/hex/{hex}` |
| **파라미터** | `hex` (ICAO 24bit 주소) |

**응답:** 특정 항공기의 비행 궤적 좌표 배열

---

## 3. 기상 데이터 API

### `/api/weather`

| 항목 | 값 |
|------|-----|
| **메서드** | GET |
| **소스** | KMA API Hub (apihub.kma.go.kr) + aviationweather.gov |
| **파라미터** | `type` (아래 참조) |

### 지원 타입

| type | 설명 | 소스 | 데이터 형식 |
|------|------|------|-------------|
| `metar` / `amos` | 공항기상관측 (AMOS) | KMA API Hub | 온도, 이슬점, 풍향/풍속, 기압, 시정, RVR |
| `taf` | 공항예보 | aviationweather.gov | RKPK, RKPU 예보 |
| `sigmet` | 중요기상정보 | KMA/국제 | 위험기상 영역 |
| `airmet` | 저고도 기상정보 | KMA | 저고도 위험기상 |
| `llws` | 저층 윈드시어 | KMA | 윈드시어 경보 |
| `radar` | 레이더 영상 | RainViewer API | 레이더 이미지 URL |
| `satellite` | 위성 영상 | KMA | 위성 이미지 URL |
| `lightning` | 낙뢰 정보 | KMA | 낙뢰 위치/시간 |

**METAR 응답 예시:**
```json
[
  {
    "station": "RKPU",
    "temp": -1.7,
    "dewpoint": -19.7,
    "wind_dir": 310,
    "wind_speed": 9,
    "wind_gust": 17,
    "pressure": 1024,
    "visibility": 9999,
    "rvr": 2000
  }
]
```

---

## 4. NOTAM API

### `/api/notam`

| 항목 | 값 |
|------|-----|
| **메서드** | GET |
| **소스** | AWS S3 (`notam-korea-data` 버킷) |
| **캐시** | 클라이언트 5분 |

### 파라미터

| 파라미터 | 설명 | 기본값 |
|---------|------|--------|
| `source` | `complete` (전체 DB) / `realtime` (당일) | realtime |
| `period` | `all` / `current` / `1month` / `1year` | all |
| `bounds` | `south,west,north,east` 좌표 | - |
| `limit` | 반환 개수 제한 | 0 (무제한) |

**응답 형식:**
```json
{
  "data": [
    {
      "notam_id": "A0001/25",
      "location": "RKPU",
      "full_text": "Q) RKRR/QMRLC/IV/NBO/A/000/999/3535N12921E005\nA) RKPU B) 2501100000 C) 2501152359\nE) RWY 18/36 CLSD DUE TO MAINT"
    }
  ],
  "count": 15000,
  "afterPeriodFilter": 500,
  "filtered": 120,
  "returned": 120,
  "source": "s3-complete",
  "period": "current"
}
```

---

## 5. 항공편 경로 API

### `/api/flight-route`

| 항목 | 값 |
|------|-----|
| **메서드** | GET |
| **소스** | 1차: UBIKAIS (flight_schedule.json), 2차: FlightRadar24 |

### 파라미터

| 파라미터 | 설명 |
|---------|------|
| `callsign` | 항공편 콜사인 (예: KAL319) |
| `reg` | 항공기 등록번호 (예: HL8319) |
| `hex` | ICAO 24bit 주소 |

**응답 형식:**
```json
{
  "source": "ubikais",
  "flightId": "KE319",
  "callsign": "KAL319",
  "origin": {
    "iata": "ICN",
    "icao": "RKSI",
    "name": "Incheon International"
  },
  "destination": {
    "iata": "USN",
    "icao": "RKPU",
    "name": "Ulsan Airport"
  }
}
```

---

## 6. 항공편 스케줄 API

### `/api/flight-schedule`

| 항목 | 값 |
|------|-----|
| **메서드** | GET |
| **소스** | AviationStack API |
| **파라미터** | `flight` (편명) |

---

## 7. 항공기 사진 API

### `/api/aircraft-photo`

| 항목 | 값 |
|------|-----|
| **메서드** | GET |
| **소스** | Planespotters.net 등 |
| **파라미터** | `registration`, `hex` |

**응답:** 항공기 사진 URL

---

## 정적 데이터 파일

| 파일 경로 | 크기 | 내용 |
|----------|------|------|
| `/aviation_data.json` | 1.8MB | 웨이포인트, 항로, 공역 데이터 |
| `/atc_sectors.json` | 155KB | ATC 섹터 경계 좌표 |
| `/flight_schedule.json` | 10KB | UBIKAIS 비행 스케줄 |
| `/data/korea_airspace.json` | - | 한국 공역 정보 |
| `/charts/chart_bounds.json` | - | 차트 경계 정보 |

---

## 외부 API 연동

| 서비스 | 용도 | 인증 |
|--------|------|------|
| **KMA API Hub** | 기상 데이터 | API Key |
| **AWS S3** | NOTAM 저장소 | Access Key |
| **Mapbox** | 지도 렌더링 | Access Token |
| **airplanes.live** | 실시간 항공기 | 무료 (Rate limit) |
| **aviationweather.gov** | TAF 예보 | 무료 |
| **RainViewer** | 레이더 영상 | 무료 |
| **hexdb.io** | 항공기 정보 | 무료 |
| **OpenSky Network** | 비행 궤적 | 무료 |

---

## 환경 변수

```env
VITE_MAPBOX_ACCESS_TOKEN=pk.eyJ1...
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
```

---

*Generated by Claude Code | RKPU Viewer v2.0.0*
