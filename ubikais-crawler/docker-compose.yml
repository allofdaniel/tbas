# UBIKAIS Crawler Docker Compose 설정
# NAS 또는 서버에서 실행

version: '3.8'

services:
  ubikais-crawler:
    build: .
    container_name: ubikais-crawler
    restart: unless-stopped
    environment:
      - UBIKAIS_USERNAME=${UBIKAIS_USERNAME:-allofdanie}
      - UBIKAIS_PASSWORD=${UBIKAIS_PASSWORD:-pr12pr34!!}
      - CRAWL_MODE=${CRAWL_MODE:-realtime}
      - CRAWL_INTERVAL=${CRAWL_INTERVAL:-300}
      - FULL_CRAWL_HOUR=${FULL_CRAWL_HOUR:-6}
      - TZ=Asia/Seoul
    volumes:
      - ./data:/app/data
    ports:
      - "8080:8080"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 5m
      timeout: 30s
      retries: 3
      start_period: 30s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # 선택사항: 웹 서버로 데이터 제공
  nginx:
    image: nginx:alpine
    container_name: ubikais-data-server
    restart: unless-stopped
    ports:
      - "8081:80"
    volumes:
      - ./data:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - ubikais-crawler
    profiles:
      - webserver

networks:
  default:
    name: ubikais-network
